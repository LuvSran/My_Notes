# Fans（easy）
在LuvSran´s Fan Club里面，总共有n个粉丝(n<＝300000)。每个粉丝都对LuvSran有一个喜爱度，第i个粉丝的喜爱度为a[i](-10000<=a[i]<=1 000000)。LuvSran将给你两个数字l和r。对于l和r(1<=l < r<=n)，他想知连续且非空的一段粉丝L~R(L<=l，R>=r)的喜爱度之和最大为多少？也就是说，选取一段区间，区间包含l~r，问区间区间喜爱度和最大为多少？他将发出Q次提问(Q<=300000)，请你回答他

# Fans (hard)
在LuvSran's Fan Club，总共有n个粉丝(n<＝300000)。每个粉丝都对LuvSran有一个喜爱度，第i个粉丝的喜爱度为a\[i](-10000<=a\[i]<=1 000000)。LuvSran将进行Q次操作(Q<=300000)。操作有两种情况，每次操作给你一个type，不同的type代表不同的操作。type1,2代表的操作如下如下
1.给你整数p，x。表示第p个粉丝的喜爱度变成了x。
2.给你整数L,R,l,r（1<=L< l＜r<R<=n）。表示在L~R间任意选取两段区间作为区间1和区间2，两段区间都要包含l~r。这个选法的喜爱值定义为区间1的粉丝喜爱度之和减去区间2的粉丝喜爱度之和。问你喜爱值最大为多少？
##  solution
每次询问$L\sim R$选取两段区间，为$l \sim r$的扩展区间，且使其差值最大，那么我们就要选取符合条件的和最大的区间 与 和最小的区间。要符合要求，那么区间右端点一定要在 $r \sim R$ 的范围内，左端点一定要在 $L \sim l$ 范围内。我们要选取合适的左右端点获得满足要求的最大/最小子段和，那么我们处理出数列 $a$ 的前缀和数组 $pre[i]$ 表示 $1\sim i$ 的和，线段树处理 $pre$ 数组，我们每次查询 $L\sim l$ 和 $r\sim R$ 的最大/最小值，然后$max_{r\sim R}-min_{L\sim l}$得到区间1和，$min_{r\sim R}-max_{L\sim l}$得到区间2和。修改操作，
线段树区间修改对 $p\sim n$加上$x$与原$a[p]$的差值就行了
